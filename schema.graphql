### Protocol Level ###
type Protocol @entity {
  id: Bytes!
  vaults: [Vault!] @derivedFrom(field: "protocol")
  totalDeposits: BigInt!
  totalDepositAmount: BigInt!
  totalValueLocked: BigInt!
  tradeFee: BigInt!
  withdrawalFee: BigInt!
  acceptedToken: [Token!]!
}

### Vault Level ###
type Vault @entity {
  id: Bytes!

  " Swap Vault or Leverage Vault"
  type: String!

  " link to the protocol entity "
  protocol: Protocol!

  AUM: BigDecimal
  tokenBalances: BigInt
  depositCount: BigInt
  withdrawCount: BigInt
  deposits: [Deposit!] @derivedFrom(field: "vault")
  withdrawRequest: [Withdraw!] @derivedFrom(field: "vault")
  createdAt: BigInt!
  vaultDailySnapshots: [VaultDaily!] @derivedFrom(field: "vault")
  latestDailySnapshot: String!
  trades: [Trade!]! @derivedFrom(field: "vault")
}

type VaultDaily @entity {
  id: ID!
  day: BigInt!
  timestamp: BigInt!
  vault: Vault!
  AUM: BigDecimal!
}

### Account Level ###
type Account @entity {
  id: Bytes!
  deposits: [Deposit!]
  withdrawRequests: [Withdraw!]
}

"Describes an accounts relationship with a vault"
type Position @entity {
  id: ID!
  account: Account
  vault: Vault
  "not sure if this will be a BigDecimal or an array of BigInt's depends on how users interact with a vault"
  totalDepositAmount: BigDecimal!
  totalWithdrawAmount: BigDecimal!
  currentValue: BigDecimal!
}

### Tokens used in Protocol ###
type Token @entity {
  id: Bytes!
  name: String!
  symbol: String!
  decimals: Int!
}

### Events ###
type Deposit @entity(immutable: true) {
  id: ID!
  hash: Bytes
  eventLog: BigInt
  account: Account
  amount: BigInt
  token: Token
  vault: Vault
}

" Reqest to withdraw "
type Withdraw @entity(immutable: true) {
  id: ID!
  hash: Bytes
  eventLog: BigInt
  account: Account
  amount: BigInt
  token: Token
  vault: Vault
}

" The settlement of a withdrawal request "
type WithdrawTrade @entity(immutable: true) {
  id: ID!
  hash: Bytes
  eventLog: BigInt
  account: Account
  amount: BigInt
  token: Token
}

#I'm asuming the vault will emit some type of trade event
type Trade @entity(immutable: true) {
  id: ID!
  hash: Bytes
  eventLog: BigInt
  vault: Vault
  amount: BigInt
  token: Token
}
